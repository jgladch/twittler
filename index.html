<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="moment.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');
        var $button = $('<button class="update">Update Feed</button>');
        $button.appendTo($body);

        // Gets tweets from streams.home
        function getLastTweets(num) {
          for (var i = (streams.home.length - 1); i > ((streams.home.length - 1) - num); i--) {
            var tweet = streams.home[i];
            var $tweet = $('<div data-user=\"'+ streams.home[i].user +'\"></div>');
            $tweet.text('@' + tweet.user + ': ' + tweet.message + " - " + moment(tweet.created_at).startOf("minute").fromNow());
            $tweet.appendTo($body);
          };
        };

        // Gets tweets from a user's timeline
        function getUsersTweets(user, num){
          for (var i = (streams.users[user].length - 1); i > ((streams.users[user].length - 1) - num); i--) {
            var tweet = streams.users[user][i];
            var $tweet = $('<div data-user=\"'+ user +'\"></div>');
            $tweet.text('@' + tweet.user + ': ' + tweet.message + " - " + moment(tweet.created_at).startOf("minute").fromNow());
            $tweet.appendTo($body);
          };
        }
        
        $(".update").on('click',function(){
          $('div').remove();
          getLastTweets(10);
          divListener();
        });

        // Clicking "Update" somehow unlinks this event handler and getUsersTweets doesn't work after clicking "Update"
        function divListener(){$("div").on('click', function(){
          var user = $(this).data("user");
          getUsersTweets(user, 10);
          });
        };

        //Initial tweets after page load
        getLastTweets(10);
        divListener();

      });

    </script>
  </body>
</html>
